<html>
    <head>
        <meta charset="utf-8">
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>        
        <link href="css/site.css" rel="stylesheet">
        <script src="js/site.js"></script>
        <script src="js/carregaMenu.js"></script>
        <title>Debate Mapas - Resultado</title>
    </head>
    <body>
        <div id="menu"></div>
        <div id="corpo" class="container">
            <h2>Resultado</h2>
            <div class="form-group">
                <div style="width: 50%">
                    <select name="debate" id="debate" tabindex="1" class="form-control">        
                    </select>
                </div>
            </div>
            <table class="table" id="table-unidades-dabate">
                <thead>
                    <tr>
                        <th>Autor</th>
                        <th>Questionador 1</th>
                        <th>Questionador 2</th>
                        <th>Distância inicial</th>
                        <th>Distância final</th>
                        <th>Aproximação</th>
                    </tr>
                </thead>
                <tbody id="lista-unidades-debate">
                </tbody>
            </table>
        </div>
    </body>
</html>
<script>
    var sucessoDebates = function (debates){
        $("#debate").empty();
        debates.forEach(element => {
            var item = '<option value="'+ element._id +'">' + element.name + '</option>';
            $("#debate").append(item);
        });

        if(debates.length > 0)
            $("#debate").change();
    };

    $("#debate").change(function(){
        var sucessoDebateUnities = function(debateUnities){
            $("#table-unidades-dabate>tbody").empty();
            debateUnities.forEach(function(item, i) {
                if(item.initialDistance || item.initialDistance === 0){
                    var distanciaFinal = item.finalDistance ? item.finalDistance.toFixed(3) : "";
                    var aproximacao = item.finalDistance ? (item.initialDistance - item.finalDistance).toFixed(3) : "";

                    var itemDebate = "<tr><td>" + item.mapsAuthor.username + "</td>" +
                        "<td>" + (item.questioner1 ? item.questioner1.username : "") + "</td>" +
                        "<td>" + (item.questioner2 ? item.questioner2.username : "") + "</td>" +
                        "<td>" + item.initialDistance.toFixed(3) + "</td>" +
                        "<td>" + distanciaFinal + "</td>" + 
                        "<td>" + aproximacao + "</td></tr>";

                    $("#table-unidades-dabate>tbody").append(itemDebate);
                }
            });
        };

        var idDebate = $("#debate").val();

        buscarUnidadesDebate(idDebate, sucessoDebateUnities);
    });
    
    buscarDebates(sucessoDebates);
</script>